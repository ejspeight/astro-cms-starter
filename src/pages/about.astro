---
/**
 * About Page â€” Heading, intro, featured image, body content, and team members.
 */

import BaseLayout from "../layouts/BaseLayout.astro";
import { getEntry, getCollection, render } from "astro:content";

const page = await getEntry("pages", "about");
if (!page) throw new Error("Missing content: src/content/pages/about.md");

const { Content } = await render(page);
const { heading, intro, featured_image, seo_description, og_image } = page.data;

// Get team members sorted by sort_order
const teamMembers = (await getCollection("team")).sort(
  (a, b) => (a.data.sort_order ?? 0) - (b.data.sort_order ?? 0)
);
---

<BaseLayout
  title="About"
  description={seo_description || undefined}
  ogImage={og_image || undefined}
>
  <main class="flex-1">
    <!-- Page header -->
    <section class="bg-secondary text-text-light py-16 md:py-20 px-6">
      <div class="max-w-3xl mx-auto text-center">
        <h1 class="text-4xl md:text-5xl font-bold font-heading text-text-light">{heading}</h1>
        {intro && (
          <p class="mt-4 text-lg text-text-muted max-w-2xl mx-auto">{intro}</p>
        )}
      </div>
    </section>

    <!-- Featured image -->
    {featured_image && (
      <div class="max-w-4xl mx-auto -mt-8 px-6">
        <img
          src={featured_image}
          alt={heading}
          class="w-full rounded-lg shadow-lg"
          loading="lazy"
        />
      </div>
    )}

    <!-- Body content -->
    <section class="py-12 md:py-16 px-6">
      <div class="max-w-3xl mx-auto prose prose-slate">
        <Content />
      </div>
    </section>

    <!-- Team members -->
    {teamMembers.length > 0 && (
      <section class="py-12 md:py-16 px-6 bg-accent-muted">
        <div class="max-w-5xl mx-auto">
          <h2 class="text-3xl font-bold text-center mb-10 font-heading">Meet the Team</h2>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
            {teamMembers.map(async (member) => {
              const { Content: MemberBio } = await render(member);
              return (
                <div class="bg-accent rounded-lg shadow-sm border border-border p-6 text-center">
                  {member.data.photo ? (
                    <img
                      src={member.data.photo}
                      alt={member.data.name}
                      class="w-24 h-24 rounded-full mx-auto mb-4 object-cover"
                      loading="lazy"
                    />
                  ) : (
                    <div class="w-24 h-24 rounded-full mx-auto mb-4 bg-primary-light flex items-center justify-center">
                      <span class="text-2xl font-bold text-primary">
                        {member.data.name.charAt(0)}
                      </span>
                    </div>
                  )}
                  <h3 class="text-lg font-bold font-heading">{member.data.name}</h3>
                  <p class="text-sm text-text-muted mb-3">{member.data.role}</p>
                  <div class="text-sm text-text-body prose prose-sm">
                    <MemberBio />
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      </section>
    )}
  </main>
</BaseLayout>
